---
const url = new URL(Astro.request.url);
const path = url.pathname;
console.log({ path });

// get matching page from database
// or else send to not-found page??

const db = Astro.locals.runtime.env.DB;

// Only replace the first slash on purpose
const pathWithoutSlash = path.replace('/', '');
console.log({ pathWithoutSlash });
const result = await db
  .prepare('SELECT * FROM page WHERE path = ?')
  .bind(pathWithoutSlash)
  .first();

if (!result) {
  return new Response('Page not found', { status: 404 });
}
---

<html lang='en'>
  <head>
    <meta charset='utf-8' />
    <meta name='viewport' content='width=device-width' />
    <meta name='generator' content={Astro.generator} />
    <title>Robots Blogging</title>
    <style set:text={result.css}></style>
  </head>
  <body set:html={result.html}>
    <script set:text={result.javascript} />
  </body>
</html>
